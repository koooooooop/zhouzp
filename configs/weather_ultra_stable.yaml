# MÂ²-MOEPæ ‡å‡†é…ç½® - weatheræ•°æ®é›† ğŸ”§ æŒ‰ç…§æ–‡æ¡£è¦æ±‚é‡æ–°è®¾è®¡
# å®ç°å®Œæ•´çš„Flowæ¨¡å‹æ˜ å°„ + åº¦é‡å­¦ä¹ é—¨æ§ + ä¸“å®¶åŸå‹æœºåˆ¶

data:
  dataset_name: "weather"
  data_path: "dataset/weather/weather.csv"
  seq_len: 96
  pred_len: 96
  features: "M"  # multivariate
  target: "OT"
  # è®­ç»ƒæ•°æ®é…ç½®
  train_ratio: 0.7
  val_ratio: 0.2
  test_ratio: 0.1
  # æ•°æ®åŠ è½½é…ç½®
  batch_size: 8             # ğŸ”§ é€‚ä¸­çš„æ‰¹æ¬¡å¤§å°
  num_workers: 2
  pin_memory: true
  # æ•°æ®å¤„ç†é…ç½®
  scaler_type: "standard"
  normalize: true
  inverse: false
  standardize: true
  
model:
  model_name: "M2_MOEP"
  
  # åŸºç¡€æ¨¡å‹å‚æ•° - æŒ‰ç…§æ–‡æ¡£è¦æ±‚
  input_dim: 21
  output_dim: 21
  hidden_dim: 64            # ğŸ”§ é€‚ä¸­çš„éšè—å±‚ç»´åº¦
  seq_len: 96
  pred_len: 96
  
  # ä¸“å®¶ç³»ç»Ÿå‚æ•° - å¤šä¸“å®¶è®¾è®¡
  num_experts: 4            # ğŸ”§ å¤šä¸“å®¶æ¨¡å¼
  top_k: 2                  # ğŸ”§ æ¿€æ´»2ä¸ªä¸“å®¶
  embedding_dim: 128        # ğŸ”§ åµŒå…¥ç»´åº¦
  
  # ä¸“å®¶ç½‘ç»œå‚æ•° - å¤šå°ºåº¦è®¾è®¡
  expert_params:
    mamba_d_model: 64       # ğŸ”§ Mambaæ¨¡å‹ç»´åº¦
    mamba_scales: [1, 2, 4] # ğŸ”§ å¤šå°ºåº¦è®¾è®¡
    
  # Flowæ¨¡å‹å‚æ•° - ğŸ”§ æ¢å¤Flowæ¨¡å‹çš„æ­£ç¡®ä½¿ç”¨
  flow:
    num_layers: 2           # ğŸ”§ Flowå±‚æ•°
    hidden_dim: 64          # ğŸ”§ Flowéšè—å±‚ç»´åº¦
    input_dim: 2016         # 21 * 96 (input_dim * seq_len)
    use_stable_flow: true   # ğŸ”§ ä½¿ç”¨æ•°å€¼ç¨³å®šçš„Flow
    
  # ä¸‰å…ƒç»„æŸå¤±å‚æ•° - æŒ‰ç…§æ–‡æ¡£è¦æ±‚
  triplet:
    margin: 0.5             # ğŸ”§ ä¸‰å…ƒç»„æŸå¤±è¾¹ç•Œ
    mining_strategy: "batch_hard"  # ğŸ”§ å›°éš¾è´Ÿæ ·æœ¬æŒ–æ˜
    
training:
  # åŸºç¡€è®­ç»ƒå‚æ•° - ä¿å®ˆä½†æœ‰æ•ˆ
  batch_size: 8             # ğŸ”§ é€‚ä¸­çš„æ‰¹æ¬¡å¤§å°
  learning_rate: 0.0001     # ğŸ”§ ä¿å®ˆçš„å­¦ä¹ ç‡
  epochs: 20                # ğŸ”§ é€‚ä¸­çš„è®­ç»ƒè½®æ•°
  
  # ä¼˜åŒ–å™¨å‚æ•°
  optimizer: "adamw"
  weight_decay: 0.01        # ğŸ”§ é€‚ä¸­çš„æƒé‡è¡°å‡
  beta1: 0.9
  beta2: 0.999
  eps: 1e-8
  
  # å­¦ä¹ ç‡è°ƒåº¦
  scheduler: "cosine"       # ğŸ”§ ä½™å¼¦é€€ç«
  lr_min: 1e-6              
  warmup_epochs: 2          # ğŸ”§ é¢„çƒ­è½®æ•°
  
  # æ¢¯åº¦æ§åˆ¶ - æ›´åˆç†çš„è®¾ç½®
  gradient_clip: 1.0        # ğŸ”§ åˆç†çš„æ¢¯åº¦è£å‰ªé˜ˆå€¼
  use_amp: false            # æš‚æ—¶ç¦ç”¨æ··åˆç²¾åº¦
  
  # æŸå¤±å‡½æ•°æƒé‡ - æŒ‰ç…§MÂ²-MOEPæ–‡æ¡£
  loss_weights:
    prediction: 1.0         # ä¸»è¦é¢„æµ‹æŸå¤±
    reconstruction: 0.1     # ğŸ”§ Flowæ¨¡å‹é‡æ„æŸå¤±
    triplet: 0.1            # ğŸ”§ ä¸‰å…ƒç»„è·¯ç”±æŸå¤±
    prototype_reg: 0.01     # ğŸ”§ ä¸“å®¶åŸå‹æ­£åˆ™åŒ–
    load_balance: 0.01      # ğŸ”§ è´Ÿè½½å‡è¡¡æŸå¤±
  
  # è®­ç»ƒç­–ç•¥ - æ¢å¤å®Œæ•´åŠŸèƒ½
  use_reconstruction_loss: true   # ğŸ”§ å¯ç”¨é‡æ„æŸå¤±
  use_triplet_loss: true          # ğŸ”§ å¯ç”¨ä¸‰å…ƒç»„æŸå¤±
  
  # éªŒè¯å’Œä¿å­˜è®¾ç½®
  val_check_interval: 1
  save_top_k: 3             
  
  # æ—©åœè®¾ç½®
  early_stopping:
    patience: 5             # ğŸ”§ åˆç†çš„ç­‰å¾…æ—¶é—´
    min_delta: 0.0001       # ğŸ”§ æœ€å°æ”¹å–„
    
  # æ•°å€¼ç¨³å®šæ€§è®¾ç½®
  numerical_stability:
    loss_clamp_max: 10.0    # ğŸ”§ åˆç†çš„æŸå¤±ä¸Šé™
    grad_norm_threshold: 1.0 # ğŸ”§ åˆç†çš„æ¢¯åº¦èŒƒæ•°é˜ˆå€¼
    nan_detection: true
    
# è¾“å‡ºè®¾ç½®
output:
  save_dir: "checkpoints"
  log_dir: "logs"
  result_dir: "results"
  
# è®¾å¤‡è®¾ç½®
device: "cuda"
seed: 42

# è°ƒè¯•è®¾ç½®
debug:
  log_gradients: true
  check_numerical: true
  profile_memory: false
  
# å®éªŒè®¾ç½®
experiment:
  name: "weather_m2_moep_standard"
  description: "Weatheræ•°æ®é›†MÂ²-MOEPæ ‡å‡†å®éªŒ - å®Œæ•´Flowæ¨¡å‹+åº¦é‡å­¦ä¹ é—¨æ§+ä¸“å®¶åŸå‹"
  tags: ["weather", "m2_moep", "flow_model", "metric_learning", "expert_prototypes"] 