# Weather ç¨³å®šè®­ç»ƒé…ç½® v2
# é’ˆå¯¹æ¢¯åº¦çˆ†ç‚¸é—®é¢˜çš„ä¼˜åŒ–ç‰ˆæœ¬

data:
  dataset_name: "weather"
  data_path: "m2moep/dataset/weather/weather.csv"
  seq_len: 96
  pred_len: 24
  features: "M"
  target: "OT"
  train_ratio: 0.7
  val_ratio: 0.2
  test_ratio: 0.1
  batch_size: 8
  num_workers: 2
  pin_memory: true
  scaler_type: "standard"
  normalize: true
  inverse: false
  standardize: true
  
model:
  model_name: "M2_MOEP"
  
  # åŸºç¡€å‚æ•° - æ›´ä¿å®ˆçš„è®¾ç½®
  input_dim: 21
  output_dim: 21
  hidden_dim: 32              # ğŸ”§ è¿›ä¸€æ­¥å‡å°éšè—å±‚ç»´åº¦
  seq_len: 96
  pred_len: 24
  
  # ä¸“å®¶ç³»ç»Ÿå‚æ•° - å‡å°‘å¤æ‚åº¦
  num_experts: 2              # ğŸ”§ å‡å°‘ä¸“å®¶æ•°é‡
  top_k: 1                    # ğŸ”§ åªé€‰æ‹©æœ€ä¼˜ä¸“å®¶
  embedding_dim: 64           # ğŸ”§ å‡å°åµŒå…¥ç»´åº¦
  
  # ä¸“å®¶ç½‘ç»œå‚æ•° - æ›´ç¨³å®šçš„åˆå§‹åŒ–
  expert_params:
    mamba_d_model: 32
    mamba_scales: [1, 2]      # ğŸ”§ å‡å°‘å°ºåº¦æ•°
    initial_delta: 1.0        # ğŸ”§ è®¾ç½®æ›´å°çš„åˆå§‹delta
    
  # æ¸©åº¦è°ƒåº¦å‚æ•° - æ›´ä¿å®ˆ
  temperature:
    initial: 2.0              # ğŸ”§ é™ä½åˆå§‹æ¸©åº¦
    min: 0.5
    max: 5.0
    decay_rate: 0.98
    
  # Flowæ¨¡å‹å‚æ•° - ç®€åŒ–
  flow:
    num_layers: 2             # ğŸ”§ å‡å°‘å±‚æ•°
    hidden_dim: 64            # ğŸ”§ å‡å°éšè—å±‚
    latent_dim: 128           # ğŸ”§ å‡å°æ½œåœ¨ç»´åº¦
    input_dim: 504            # 21 * 24
    use_pretrained: false     # ğŸ”§ æš‚æ—¶å…³é—­é¢„è®­ç»ƒ
    
training:
  # åŸºç¡€è®­ç»ƒå‚æ•° - æ›´ä¿å®ˆ
  batch_size: 8
  learning_rate: 0.00001      # ğŸ”§ å¤§å¹…é™ä½å­¦ä¹ ç‡
  epochs: 50
  
  # ä¼˜åŒ–å™¨å‚æ•° - æ›´ç¨³å®š
  optimizer: "adamw"
  weight_decay: 0.001         # ğŸ”§ å‡å°æƒé‡è¡°å‡
  beta1: 0.9
  beta2: 0.999
  eps: 1e-8
  
  # å­¦ä¹ ç‡è°ƒåº¦ - æ›´å¹³ç¼“
  scheduler: "reduce_on_plateau"  # ğŸ”§ æ”¹ç”¨è‡ªé€‚åº”è°ƒåº¦
  factor: 0.5
  patience: 5
  min_lr: 1e-7
  
  # æ¢¯åº¦æ§åˆ¶ - æ›´ä¸¥æ ¼
  gradient_clip: 0.1          # ğŸ”§ ä¸¥æ ¼æ¢¯åº¦è£å‰ª
  use_amp: false
  
  # æŸå¤±å‡½æ•°æƒé‡ - æ›´å¹³è¡¡
  loss_weights:
    prediction: 1.0
    reconstruction: 0.01      # ğŸ”§ é™ä½é‡æ„æŸå¤±æƒé‡
    triplet: 0.001            # ğŸ”§ é™ä½ä¸‰å…ƒç»„æŸå¤±æƒé‡
  
  # è®­ç»ƒç­–ç•¥ - é€æ­¥å¯ç”¨
  use_reconstruction_loss: false  # ğŸ”§ å…ˆå…³é—­é‡æ„æŸå¤±
  use_triplet_loss: false         # ğŸ”§ å…ˆå…³é—­ä¸‰å…ƒç»„æŸå¤±
  
  # æ•°å€¼ç¨³å®šæ€§ - æ›´ä¸¥æ ¼
  numerical_stability:
    loss_clamp_max: 5.0       # ğŸ”§ æ›´ä¸¥æ ¼çš„æŸå¤±è£å‰ª
    grad_norm_threshold: 0.1  # ğŸ”§ æ›´å°çš„æ¢¯åº¦é˜ˆå€¼
    nan_detection: true
    weight_init_scale: 0.1    # ğŸ”§ æƒé‡åˆå§‹åŒ–ç¼©æ”¾
    
  # éªŒè¯è®¾ç½®
  val_check_interval: 1
  save_top_k: 3
  
  # æ—©åœè®¾ç½® - æ›´æ•æ„Ÿ
  early_stopping:
    patience: 5               # ğŸ”§ æ›´å°çš„è€å¿ƒå€¼
    min_delta: 0.0001         # ğŸ”§ æ›´å°çš„æ”¹å–„é˜ˆå€¼
    
# è¾“å‡ºè®¾ç½®
output:
  save_dir: "checkpoints"
  log_dir: "logs"
  result_dir: "results"
  
# è®¾å¤‡è®¾ç½®
device: "cuda"
seed: 42

# è°ƒè¯•è®¾ç½®
debug:
  log_gradients: true
  check_numerical: true
  profile_memory: false
  
# å®éªŒè®¾ç½®
experiment:
  name: "weather_stable_v2"
  description: "æ¢¯åº¦çˆ†ç‚¸ä¿®æ­£ç‰ˆé…ç½®"
  tags: ["weather", "stable", "gradient_fix"] 